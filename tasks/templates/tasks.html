{% extends "base.html" %}

{% block title %}{{ project }} - Task Cloud{% endblock %}

{% block content %}
<header>
    <a href="/" class="back-link">&larr; Back to Projects</a>
    <h1>{{ project }}</h1>
    <button class="btn-create" onclick="openCreateModal('task', '{{ project }}')" title="Create Task">+</button>
    <div class="search-container">
        <input type="text" class="search-box" id="search-input" placeholder="Search tasks..." oninput="filterTasks(this.value)">
        <button class="search-clear" onclick="clearSearch()" title="Clear search">&times;</button>
    </div>
    <div class="view-toggle">
        <a href="/project/{{ project }}" class="active">Cloud</a>
        <a href="/kanban/{{ project }}">Kanban</a>
    </div>
</header>

<div class="cloud">
    {% for t in tasks %}
    <div class="card" data-body="{{ t.body }}" data-plan="{{ t.plan }}" data-report="{{ t.report }}" data-review="{{ t.review }}" data-blocks="{{ t.blocks }}" data-title="#{{ t.number }} {{ t.description }}" data-project="{{ project }}" data-number="{{ t.number }}" data-status="{{ t.status }}" data-started="{{ t.started or '' }}" data-completed="{{ t.completed or '' }}" data-branch="{{ t.branch or '' }}" data-module="{{ t.module or '' }}">
        <div class="card-title">#{{ t.number }}{% if t.branch %}<span class="branch-badge">{{ t.branch }}</span>{% endif %} {{ t.description }}{% if t.module %}<span class="module-badge">{{ t.module }}</span>{% endif %}</div>
        <div class="card-row">
            <span class="status-badge status-{{ t.status }}">{{ t.status }}</span>
            <div class="section-icons">
                <span class="section-icon {{ 'has-content' if t.body else '' }}" title="Description">D</span>
                <span class="section-icon {{ 'has-content' if t.plan else '' }}" title="Plan">P</span>
                <span class="section-icon {{ 'has-content' if t.review else '' }}" title="Review">RV</span>
                <span class="section-icon {{ 'has-content' if t.report else '' }}" title="Report">RP</span>
                <span class="section-icon {{ 'has-content' if t.blocks else '' }}" title="Blocks">B</span>
            </div>
        </div>
        {% if t.started or t.completed %}
        <div class="card-dates">
            {% if t.started %}<span>S: {{ t.started }}</span>{% endif %}
            {% if t.completed %}<span>C: {{ t.completed }}</span>{% endif %}
        </div>
        {% endif %}
        {% if t.depends_on %}
        <div class="blocked-by">
            blocked:
            {% for d in t.depends_on %}
            <span class="blocked-badge">#{{ d }}</span>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% else %}
    <p class="card-meta">No tasks yet.</p>
    {% endfor %}
</div>
{% endblock %}
