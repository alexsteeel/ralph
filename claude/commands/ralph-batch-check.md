---
name: ralph-batch-check
description: Run full test suite after batch implementation, fix indirect issues
arguments:
  - name: task_refs
    description: List of completed task references (e.g., "project#1 project#2 project#3")
    required: true
---

Запусти полный набор тестов и исправь косвенные проблемы после пула задач.

## Цель

После выполнения нескольких задач могут возникнуть косвенные проблемы:
- Конфликты между изменениями разных задач
- Сломанные тесты в других модулях
- Регрессии в не затронутых напрямую компонентах

**Task references:** `$ARGUMENTS`

## Workflow

### 1. Создай задачу проверки в md-task-mcp

Описание: "Batch check after tasks: <список номеров>"

### 2. Получи информацию о коммитах из задач

Для каждой задачи из списка извлеки commit hash из поля `report`.

### 3. Запусти полный набор тестов

```bash
pytest -v --tb=short 2>&1 || true
```

### 4. При наличии failing tests

Для каждого падающего теста:

1. **Проанализируй причину** — какой код вызывает ошибку
2. **Определи источник** — из какой задачи/коммита пришло изменение
3. **Исправь проблему** — внеси минимальные изменения
4. **Запусти тест повторно** — убедись что исправлено

### 5. Запиши отчёт в задачу проверки

В поле `report` укажи:
- Статус: все тесты прошли / исправлено N проблем
- Для каждой проблемы: тест, ошибка, источник (задача/коммит), причина, исправление
- Коммит с исправлениями (если были)

Переведи задачу в `done`.

### 6. Создай коммит если были исправления

```bash
git add -A
git commit -m "Fix indirect issues from batch #N #M #K"
```

### 7. Выведи финальный отчёт

```
✅ BATCH CHECK COMPLETED

Задача проверки: project#X
Проверено задач: N
Найдено проблем: M
Исправлено: M

Коммит: <hash> (если были исправления)
```

## Ограничения

- **Только тесты** — линтеры уже прошли в каждой задаче
- **Минимальные исправления** — не рефакторить, только фиксить проблемы
- **Документировать источник** — всегда указывать из какой задачи пришла проблема
